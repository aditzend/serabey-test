<template name="Order_show_page">
    {{#if Template.subscriptionsReady}}
        {{#staggering}}
            <div class='wrapper'>
                <div class='row'>
                    {{#pageTitle title=(_ "Order")}}
                        <!-- <h2> 
    {{#if companyLogo workfor}}
    <img src="{{companyLogo workfor}}" alt="" />
    {{else}}
    {{companyName workfor}}
    {{/if}}
   </h2> -->  
   <div class='text-center'>
     <h6><i class='fa fa-clock-o'></i> {{timeFromCreation order.createdAt}} {{_ "by"}} {{order.authorName}} {{order.authorLastName}}</h6>
   </div>
  

   
                    {{/pageTitle}}
                </div>
                <div class='row'>
                    <div class="col col-xs-12 col-md-6 col-lg-4">
                    
                {{#panel title=(_ "Customer") built=true}}
                        {{#if company}}
                            <h6>{{_ "Selling to"}}:  </h6>
                              <h3>{{companyName}}</h3>  
                          
                            <h6>{{_ "Payment days"}}:
                                {{paymentDays}}
                            </h6>
                                    {{#if showCompanyDetails}}
                                    
                                        <button class='btn btn-default js-hide-company-details'>{{_ 'Hide details'}}</button>

                                        {{#panel title=(_ "Customer details")}}
                                            {{> Company_DECS customerArgs company}}
                                        {{/panel}}
                                    {{else}}
                                        <button class='btn btn-default btn-sm js-show-company-details'>{{_ 'View details'}}</button>
                                    {{/if}}
                            <button class='btn btn-default btn-sm js-show-company-switch'>{{_ 'Switch'}}</button>
                        {{else}}
                      
                            {{> Company_DECS customerArgs }}
                        {{/if}}
                        
                        {{/panel}}
                      <!-- </div>
                      
                      <div class="col col-xs-12 col-md-6 col-lg-4">   -->
                        {{#panel title=(_ "Files") built=true}}
                        {{#if uploadingFile}}
                        <div class="input-group input-group-lg">
                         <input type="text" id="uploadingFileInput" class="form-control" placeholder="{{_ "'Order', 'Specs'"}}">
                         <span class="input-group-btn">
                           <button class="btn btn-success js-upload-file" type="button">   <i class="fa fa-cloud-upload"></i>   </button>
                           <button class="btn btn-danger js-cancel-upload-file" type="button">   <i class="fa fa-times"></i>   </button>
                         </span>
                       </div><!-- /input-group -->
                       
                       

                        
                        {{else}}
                        <button class="btn btn-primary js-goto-upload-file"><i class="fa fa-cloud-upload"></i> {{_ "Upload file"}}</button>
                     {{/if}}
                      
                     
                     <div class="text-center">
                       {{#each file in order.files}}
                       <a href='{{file.url}}' target="_blank" class='btn btn-default'><i class="fa fa-file-text"></i> {{file.name}}</a>
                       
                       {{/each}}
                       <!-- {{files}} -->
                     
                     </div>
                        {{/panel}}
                      </div>
                    <!-- <div class="col-xs-8 col-lg-2"> -->
                      <!-- {{#if dateDefined}}
                      <br>
                      <p><span class='text-default'>{{_ "Emission"}} : {{emissionDate}}</span></p>
                      <p><span class='text-default'>{{_ "Due"}} : {{dueDate}}</span></p>
                      {{/if}} -->

                        <!-- <label for="emission-date">{{_ "Emission date"}}</label>
                        <input id="emission-date" name='emission-date' type="text" class="date-picker form-control">

                        <label for="due-date">{{_ "Due date"}}</label>
                        <input id="due-date" type="text" name='due-date' class="date-picker form-control"> -->
<!-- 
                        <div class='row'>
                            <div class="col-xs-12 ">
                              {{#if invoiceType}}
                                <span class="help-block small-font">{{_ "Invoice type"}} :
                              <button class='btn btn-default js-edit-invoice-type'> {{invoiceType}}</button>   </span>
                              {{else}}
                                <select name='invoiceType' class="form-control js-invoice-type" >
                                    <option value=''>{{_ "Select invoice type"}}</option>
                                    <option value='A'>A</option>
                                    <option value='B'>B</option>
                                    <option value='C'>C</option>
                                    <option value='M'>M</option>
                                    <option value='E'>E</option>
                                </select>
                                {{/if}}
                            </div>
                        </div> -->

                    <!-- </div> -->
                  

                <!-- {{#if order.soldProducts}} -->
                
  <div class="col col-xs-12 col-md-6 col-lg-4">          
{{#panel title=(_ "Details") built=true}}
                        <!-- <div class="table-responsive">
                            <table cellpadding="1" cellspacing="1" class="table table-condensed table-striped"> -->
                                <!-- <thead>
                                    <tr>
                                        <th>{{_ "Product"}}</th>
                                        <th>{{_ "Amount"}}</th>
                                        <th>{{_ "Price"}}</th>
                                        <th>{{_ "Disc."}}</th>
                                        <th>{{_ "Taxes"}}</th>
                                        <th>{{_ "Total"}}</th>
                                    </tr>
                                </thead> -->
                                <!-- <tbody> -->
                                  
                                    <ul class='list-group'>
                                      {{#if addingOrderDetail}}
                                      {{#if sellingItemName}}
                                          <li class='list-group-item'>   {{> TooDetailEdit product= sellingItemName}}
                                          </li>
                                            
                                      {{else}}
                                      <li class='list-group-item'>  
                                            {{> Item_DECS productArgs}}

                                      </li>
                                      {{/if}}
                                    {{else}}
                                    <button class="btn btn-success js-add-order-detail">{{_ "Add item"}}</button>
                                      {{/if}}
                                      {{#each detail in order.soldProducts}}

                                          {{> TooDetailShow (showDetailArgs detail) }}
                                          <!-- <tr></tr> -->

                                      {{else}}

                                          <!-- <tr> -->
                                              <!-- {{_ "Add products"}} -->

                                          <!-- </tr> -->
                                      {{/each}}
                                    </ul>
                              
                                <!-- </tbody> -->
                            <!-- </table> -->
                        <!-- </div> -->
                        

                        <!-- <tfoot> -->
                        <div class='row'>
                            <div class='col-xs-6 col-sm-6 col-md-6 col-lg-6'>
                                <h3>{{amountTotal order.soldProducts}}
                                    un</h3>
                            </div>
                            <div class='col-xs-6 col-sm-6 col-md-6 col-lg-6'>
                                <table>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <span>{{_ "Subtotal"}}</span>

                                            </td>
                                            <td>{{subtotal order.soldProducts}}</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <span>{{_ "Discount"}}</span>

                                            </td>
                                            <td>{{discount order.soldProducts}}</td>
                                        </tr>
                                        <!-- <tr>
                                        <td>
                                            <span>{{_ "Subtotal w/ disc."}}</span>

                                        </td>
                                        <td>{{discountTotal}}</td>
                                    </tr> -->
                                        <tr>
                                            <td>
                                                <span>{{_ "Net total"}}</span>

                                            </td>
                                            <td>{{netTotal order.soldProducts}}</td>
                                        </tr>

                                        <tr>
                                            <td>
                                                <span>{{_ "Taxes"}}</span>

                                            </td>
                                            <td>{{taxes order.soldProducts}}</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <h3>{{_ "Grand total"}}
                                                    :
                                                    {{grandTotal order.soldProducts}}</h3>
                                                    
                                                    <!-- <button class='btn btn-success js-save-sale'>{{_ "Confirm sale"}}</button> -->
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                        {{/panel}}
                      </div>
                    
                        
                          <div class='col col-xs-12 col-md-6 col-lg-4'>
                            {{#panel title=(_ "Deliveries") built=true}}
                        
                          {{#if creatingDelivery}}
                          <div class='panel panel-default'>
                            <div class='panel-body'>
                              <h3>delivery id : {{editingDelivery._id}}</h3> 
                           {{#each item in editingDelivery.items}} 
                         
                           <p>{{item.amount}} <strong>{{item.itemName}}</strong>
                             </p>
                             <p class='text-muted'>
                               ({{item.packaging}})
                             </p>
                             <hr>
                           
                           {{/each}}
                            </div>
                            
                          </div>
                                                  {{#each product in order.soldProducts}}
                                                  <!-- <button class='btn btn-default js-delivery-select-item'>{{product.itemName}}</button> -->
                                                  <div class='panel panel-default'>
                                                    <div class='panel-body'>
                              <h3 class='text-info'>{{product.itemName}} </h3>
                              <span class='text-muted'> <strong>{{_ "Required"}}</strong> :  {{formatAsNumber product.amount}} </span>
                              <span class='text-muted'> <strong>{{_ "Delivered"}}</strong> :  {{sumAllDeliveries product.deliveries}} </span>
                              <span class='text-muted'> <strong>{{_ "Remaining"}}</strong> :  {{remainingDeliveries product.amount product.deliveries}} </span>
                              <form class="js-add-item-to-delivery-form" id='{{product.item}}' name='{{product.itemName}}'>
                                <div class='row'>
                                  <div class='col col-xs-5 col-sm-5 col-lg-5'>
                                    <div class='form-group'>
                                    <label for="amount">{{_ "Amount"}}</label>
                                    <input type='number' name='amount' class='form-control' value='{{remainingDeliveries product.amount product.deliveries}}'>
                                  </div> 
                                  </div>
                                  <div class='col col-xs-7 col-sm-7 col-lg-7'>
                                    <div class='form-group'>
                                    <label for="packaging">{{_ "Packaging"}}</label>
                                    <input type='text' name='packaging' class='form-control' >
                                  </div> 
                                  </div>
                                
                                    <button type='submit' id="{{product.item}}" class='btn btn-success '>{{_ "Add"}}</button>
                                </div>
                             
                        

                            
                            </form>
                               </div>
                               </div>
                              
                                                  {{/each}}
                                      
                                                                      
                          {{else}}
                          <div class='pull-right'>
                          
                          <button class='btn btn-success js-create-delivery'>{{_ "New delivery"}}</button>
                        </div>
                          {{/if}}
                        
                          
                            {{#each delivery in order.deliveries}}
                            <button class='btn btn-default btn-sm'> {{plusOne @index}}</button>

                            {{/each}}
                        
                            {{/panel}}
                          </div>
                          
                        
                    </div>
                <!-- row -->

              </div>

        {{/staggering}}
    {{else}}
        {{_ "Loading"}}
    {{/if}}
</template>